import React,{useState,useEffect} from "react";
import {Link} from 'react-router-dom';
import {postActivity,getActivity} from '../actions/index';
import {useDispatch,useSelector} from 'react-redux';


function validate(input){

    if(!input.name){
   alert('se re quiere un nombre')
    }else if(!input.difficulty){
        alert('se requiere una difficulty')
    }else if(!input.duration){
        alert('poner horas o dias')
    }else if(!input.season){
        alert('se requiere una season')
    }else if(input.countries<1){
        alert('Selecciona los paises en donde creaste tu actividad')
    }
    }



export default function ActivityCreated (){
const dispatch = useDispatch ();
const countries = useSelector ((state) =>state.allCountries);
const [errors,setErrors]=useState({})
const [input,setInput] =useState({
    name:"",
    difficulty:"",
    duration:"",
    season:"",
    countries:[], // quiero que se carge mas de una
})
useEffect(()=>{
    dispatch(getActivity())
},[dispatch])

function handleChange(e){
    setInput({
        ...input,
        [e.target.name] : e.target.value // tiene que agrrar el estado y modificarlo
    })
    
}
function handleSelect(e){
    setInput({
        ...input,
        countries:[...input.countries,e.target.value] //traeme lo que ya teneias y concatenale el targetvalue /voy  necesitar pasarle muchos
    })
}
function handleSubmit(e){
    e.preventDefault();
    console.log('jua' ,input)
    setErrors(validate({
        ...input,
        [e.target.value]:e.target.value
    }))
    dispatch(postActivity(input))
    alert("ACTIVIDAD CREADA")
    setInput({
    name:"",
    difficulty:"",
    duration:"",
    season:"",
    countries:[],
    })
}
function handleDelete(e){
    setInput({
        ...input,
        countries:input.countries.filter(el=>el !==e)
    })
}
function handleSeason(e){
    setInput({
        ...input,
        season:e.target.value
    })
}
function handleDifficulty(e){
    setInput({
        ...input,
        difficulty:e.target.value
    })
}

return(
    <div>
        <h1>Crear actividad</h1>
        <Link to = '/home'><button >Volver</button></Link> 
        <form>
            <div>
                <label>Name:</label>
                <input
                type='text'
                value={input.name}
                name='name'    
                onChange ={(e)=>handleChange(e)}
            />
            </div>
            <div>
                <label>Difficulty:</label>
                <select onChange={(e)=>handleDifficulty(e)}>
                <option value='1'>1</option>
                <option value='2'>2</option>
                <option value='3'>3</option>
                <option value='4'>4</option>
                <option value='5'>5</option>
                </select>
            </div>
            <div>
                <label>Duration:</label>
                <input 
                type='string'
                value={input.duration}
                name='duration'
                onChange={(e)=>handleChange(e)}
                />
            </div>
            <div>
                <label>Season:</label>
                <select onChange={(e)=>handleSeason(e)} >
                <option value ='verano'>Verano</option>
                    <option value ='invierno'>Invierno</option>
                    <option value='otoño'>Otoño</option>
                    <option value='primavera'>Primavera</option>
                    <option value='todo'>Todo el año</option>
                </select>
            </div>
            <label> countries:<select onChange={(e)=>handleSelect(e)}>
                {countries.map((e)=>(
                <option value={e.id}>{e.name} </option>
                ))}
            </select>
            
                
            </label>
            <button type='submit' onChange={(e)=> handleSubmit(e)}>Agregar activity</button>

        </form>
        {input.countries.map(e=>{
            <div> 
                <h6>{e}</h6>
                <button onClick={(e)=>handleDelete(e)}>X</button>
            </div>
        })}
    </div>
)
}